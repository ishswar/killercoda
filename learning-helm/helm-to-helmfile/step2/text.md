
Create Helm charts and use them to Deploy same set of applications

<br>

# Deploy using Helm 

Next step we can deploy same application as before but this time using helm charts. 
We will create 5 charts - one for each of application. 

General steps : 

1. Create a Helm chart using `helm create` command
1. Delete YAML files created by above command 
1. Move our original Helm files for each application under `templates` subfolder 
1. Use `helm install` to install chart 

You have two choices - create charts manually (follow below steps) or check-out branch using command `git checkout with-helm` this will get you same charts that you will have if you follow below steps.

## Creates Charts 

```plain
cd ~/example-voting-app/k8s-specifications/
helm create db  
helm create vote
helm create redis
helm create worker
helm create result
```{{exec}} 


## Delete all autogenerated YAMLs 

```plain
rm -rf */templates/*.yaml
rm -rf */templates/*.txt
rm -rf */templates/tests
```{{exec}} 

Check to see YAML is there in sub folder `templates` 

```plain
ls -la */templates/*
```{{exec}} 

## Move existing YAML for each application to it's individual Helm chart 

```plain
mv db-*.yaml db/templates/
mv vote-*.yaml vote/templates/
mv redis-*.yaml redis/templates/
mv worker-*.yaml worker/templates/
mv result*.yaml result/templates/
```{{exec}} 

At the end, if you run command `ls -la */templates/*,` the output should look like below   
Make sure you are in the directory `example-voting-app/k8s-specifications`

`ls -la */templates/*`{{exec}} 

Sample output 

```plain
-rw-r--r-- 1 root root 1732 Feb 22 04:08 db/templates/_helpers.tpl
-rw-r--r-- 1 root root  634 Feb 22 04:07 db/templates/db-deployment.yaml
-rw-r--r-- 1 root root  191 Feb 22 04:07 db/templates/db-service.yaml
-rw-r--r-- 1 root root 1762 Feb 22 04:08 redis/templates/_helpers.tpl
-rw-r--r-- 1 root root  492 Feb 22 04:07 redis/templates/redis-deployment.yaml
-rw-r--r-- 1 root root  203 Feb 22 04:07 redis/templates/redis-service.yaml
-rw-r--r-- 1 root root 1772 Feb 22 04:08 result/templates/_helpers.tpl
-rw-r--r-- 1 root root  383 Feb 22 04:07 result/templates/result-deployment.yaml
-rw-r--r-- 1 root root  221 Feb 22 04:07 result/templates/result-service.yaml
-rw-r--r-- 1 root root 1752 Feb 22 04:08 vote/templates/_helpers.tpl
-rw-r--r-- 1 root root  369 Feb 22 04:07 vote/templates/vote-deployment.yaml
-rw-r--r-- 1 root root  216 Feb 22 04:07 vote/templates/vote-service.yaml
-rw-r--r-- 1 root root 1772 Feb 22 04:08 worker/templates/_helpers.tpl
-rw-r--r-- 1 root root  317 Feb 22 04:07 worker/templates/worker-deployment.yaml
```


## Install using Helm charts 

```plain
helm install db ./db 
helm install redis ./redis
helm install worker ./worker
helm install result ./result
helm install vote ./vote
```{{exec}} 

### List all charts 

`helm list`{{exec}} 

Sample output 

```plain
NAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION
db      default         1               2023-02-22 04:10:32.109280565 +0000 UTC deployed        db-0.1.0        1.16.0     
redis   default         1               2023-02-22 04:10:34.518627295 +0000 UTC deployed        redis-0.1.0     1.16.0     
result  default         1               2023-02-22 04:10:36.716386874 +0000 UTC deployed        result-0.1.0    1.16.0     
vote    default         1               2023-02-22 04:10:38.735587035 +0000 UTC deployed        vote-0.1.0      1.16.0     
worker  default         1               2023-02-22 04:10:35.724799692 +0000 UTC deployed        worker-0.1.0    1.16.0  
```

The above shows all 5 charts are installed.   
Now you can try to access the same URLs as before to access the [ACCESS VOTE APP]({{TRAFFIC_HOST1_31000}}) application and [ACCESS RESULT APP]({{TRAFFIC_HOST1_31001}}) application.


This concludes our demo about how you can deploy same multi-tier application using Helm charts

## Tear down the setup 

```
helm uninstall db redis worker result vote 
```

Not much has changed as of now - but now in next topic we will start to externalize some of  the information so during deployment we can provide updated values. 